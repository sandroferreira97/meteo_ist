<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meteo Data</title>
    <link crossorigin="anonymous"
          href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css"
          integrity="sha256-8B1OaG0zT7uYA572S2xOxWACq9NXYPQ+U5kHPV1bJN4="
          rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" rel="stylesheet">

</head>
<body>
<nav aria-label="main navigation" class="navbar is-light" role="navigation">
    <div class="navbar-brand">
        <div class="navbar-item">
                <i class="fas fa-cloud-sun"></i>
                Meteo Data
        </div>
    </div>
   
</nav>
<div style="width:70%">
</br>
    <form style="text-align: center;">
        <label for="start">Start:</label>
        <input type="date" id="start" name="start"> 
        <label for="end">End:</label>
        <input type="date" id="end" name="end"> 
        <button onclick="setRange()">submeter</button>
    </form>
</br>

    <canvas id="chart"></canvas>
</br>
    <div style="text-align: center;">
        <button onclick="setTemp()">Temperatura</button>
        <button onclick="setPP()">Precipitação</button> 
        <button onclick="setPres()">Pressão</button>
        <button onclick="setRad()">Radiação</button>
        <button onclick="setRh()">Humidade</button>
        <button onclick="setWd()">wd</button>
        <button onclick="setWg()">wg</button>
        <button onclick="setWs()">ws</button>
    </div>

    

    <script>
        
        axios.get("range/1/")
        .then((res)=>{
        var db = res.data;
        var start = db.start;
        var end = db.end;

        document.getElementById("start").value = start;
        document.getElementById("end").value = end;
        
        })

        var data = "{{temp_data|safe}}";
        var label = "Temperatura (ºC)";

        var backgroundColor = 'rgba(54, 162, 235, 0.2)';
        var borderColor = 'rgba(54, 162, 235, 1)';
        chart();

        function setPP(){
            data = "{{pp_data|safe}}";
            label = "Precipitação (mm)";
            backgroundColor = 'rgba(255, 99, 132, 0.2)';
            borderColor = 'rgba(255, 99, 132, 1)';
            chart();
        }

        function setPres(){
            data = "{{pres_data|safe}}";
            label = "Pressão Atmosférica (mbar)";
            backgroundColor = 'rgba(255, 206, 86, 0.2)';
            borderColor = 'rgba(255, 206, 86, 1)';
            chart();
        }
        function setRad(){
            data = "{{rad_data|safe}}";
            label = "Radiação Solar (w m-2)";
            backgroundColor = 'rgba(75, 192, 192, 0.2)';
            borderColor = 'rgba(75, 192, 192, 1)';
            chart();
        }
        function setRh(){
            data = "{{rh_data|safe}}";
            label = "Humidade (%)";
            backgroundColor = 'rgba(153, 102, 255, 0.2)';
            borderColor = 'rgba(153, 102, 255, 1)';
            chart();
        }
        function setTemp(){
            data = "{{temp_data|safe}}";
            label = "Temperatura (ºC)";
            backgroundColor = 'rgba(54, 162, 235, 0.2)';
            borderColor = 'rgba(54, 162, 235, 1)';
            chart();
        }
        function setWd(){
            data = "{{wd_data|safe}}";
            label = "wd";
            chart();
        }
        function setWg(){
            data = "{{wg_data|safe}}";
            label = "wg";
            chart();
        }
        function setWs(){
            data = "{{ws_data|safe}}";
            label = "ws";
            chart();
        }
        
        
        function chart(){
            data = data.slice(1,-1).split(',');
            var data_final = []
            for(i = 0; i < data.length; i++){
                data_final.push(data[i].replace(/'/g,""));     //remove single quotes ('')
            }

            var dates = "{{date_data|safe}}".slice(1,-1).split(',');
            var dates_final = []
            for(i = 0; i < dates.length; i++){
                dates_final.push(dates[i].replace(/'/g,""));
            }
            console.log("{{end|safe}}")
            var ctx = document.getElementById('chart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates_final,
                    datasets: [{
                        label: label,
                        data: data_final,
                        fill: true,
                        backgroundColor: backgroundColor,
                        borderColor: borderColor,
                            
                        borderWidth: 3
                    }]
                }
            });
        }
        
        function setRange(){
            
            var startInput = document.getElementById("start").value;
            var startDate = startInput;
            var endInput = document.getElementById("end").value;
            var endDate = endInput;
            
            axios({
            method: 'patch',
            url: 'range/1/',
            data: {
                start: startDate,
                end: endDate
            }
          })
          .then(data=>{
            console.log(data);
          })
          .catch(error => {
            console.log(error)
          })
 

        }
        
    </script>
</div>

</body>
</html>
